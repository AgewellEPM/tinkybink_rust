//! ๐ท๐บ ะัััะบะฐั GPT ะะตะผะพะฝัััะฐัะธั - ะะฝัะตะปะปะตะบััะฐะปัะฝะฐั AAC ะกะธััะตะผะฐ
//! 
//! ะะตะผะพะฝัััะธััะตั ะผะพัั ััััะบะพะณะพ GPT ัะดัะฐ ั:
//! - ะะฑัะฐะฑะพัะบะพะน ะตััะตััะฒะตะฝะฝะพะณะพ ััััะบะพะณะพ ัะทัะบะฐ
//! - ะัะปััััะฝัะผ ัะผะพัะธะพะฝะฐะปัะฝัะผ ะฒะพัะฟัะธััะธะตะผ
//! - ะัััะบะธะผะธ ัะฐะทะณะพะฒะพัะฝัะผะธ ะฟะฐััะตัะฝะฐะผะธ
//! - ะะฝัะตะณัะฐัะธะตะน ั ััะตะฝะธัะพะฒะพัะฝัะผะธ ะดะฐะฝะฝัะผะธ

use anyhow::Result;
use colored::*;
use std::io::{self, Write};
use tinkybink_rust::ai::gpt_core_ru::{ะัััะบะพะตะฏะดัะพGPT, ะะพะฝัะธะณััะฐัะธัGPT, ะญะผะพัะธะพะฝะฐะปัะฝะพะตะกะพััะพัะฝะธะต};
use serde_json::Value;
use std::fs;
use std::path::Path;

/// ะะฐะณััะทัะธะบ ััััะบะธั ััะตะฝะธัะพะฒะพัะฝัั ะดะฐะฝะฝัั
struct ะัััะบะธะนะะฐะณััะทัะธะบะะฐะฝะฝัั {
    ัะปะพะฒะฐัั: Vec<String>,
    ะฟัะตะดะปะพะถะตะฝะธั: Vec<Vec<String>>,
    ัะผะพัะธะธ: Vec<ะญะผะพัะธะพะฝะฐะปัะฝะพะตะกะพััะพัะฝะธะต>,
}

impl ะัััะบะธะนะะฐะณััะทัะธะบะะฐะฝะฝัั {
    fn ะฝะพะฒัะน() -> Result<Self> {
        let mut ัะปะพะฒะฐัั = Vec::new();
        let mut ะฟัะตะดะปะพะถะตะฝะธั = Vec::new();
        let mut ัะผะพัะธะธ = Vec::new();
        
        // ะะฐะณััะทะธัั ะฒัะต ััััะบะธะต ััะตะฝะธัะพะฒะพัะฝัะต ัะฐะนะปั
        let ะดะธัะตะบัะพัะธั_ััะตะฝะธัะพะฒะบะธ = Path::new("training_ru");
        if ะดะธัะตะบัะพัะธั_ััะตะฝะธัะพะฒะบะธ.exists() {
            for ะทะฐะฟะธัั in fs::read_dir(ะดะธัะตะบัะพัะธั_ััะตะฝะธัะพะฒะบะธ)? {
                let ะทะฐะฟะธัั = ะทะฐะฟะธัั?;
                let ะฟััั = ะทะฐะฟะธัั.path();
                if ะฟััั.extension().and_then(|s| s.to_str()) == Some("json") {
                    let ัะพะดะตัะถะธะผะพะต = fs::read_to_string(&ะฟััั)?;
                    let ะดะฐะฝะฝัะต: Value = serde_json::from_str(&ัะพะดะตัะถะธะผะพะต)?;
                    
                    if let Some(ัะทะปั) = ะดะฐะฝะฝัะต["nodes"].as_array() {
                        for ัะทะตะป in ัะทะปั {
                            // ะะทะฒะปะตัั ัะตะบัั
                            if let Some(ัะตะบัั) = ัะทะตะป["text"].as_str() {
                                let ะฑัะบะฒั: Vec<String> = ัะตะบัั.chars()
                                    .map(|c| c.to_string())
                                    .collect();
                                ะฟัะตะดะปะพะถะตะฝะธั.push(ะฑัะบะฒั.clone());
                                for ะฑัะบะฒะฐ in ะฑัะบะฒั {
                                    if !ัะปะพะฒะฐัั.contains(&ะฑัะบะฒะฐ) {
                                        ัะปะพะฒะฐัั.push(ะฑัะบะฒะฐ);
                                    }
                                }
                            }
                            
                            // ะะทะฒะปะตัั ัะผะพัะธะธ
                            if let Some(ัะผะพัะธั) = ัะทะตะป["emotion"].as_object() {
                                let ัะพััะพัะฝะธะต = ะญะผะพัะธะพะฝะฐะปัะฝะพะตะกะพััะพัะฝะธะต {
                                    ะฒะฐะปะตะฝัะฝะพััั: ัะผะพัะธั.get("ะฒะฐะปะตะฝัะฝะพััั")
                                        .and_then(|v| v.as_f64())
                                        .unwrap_or(0.5) as f32,
                                    ะฐะบัะธะฒะฐัะธั: ัะผะพัะธั.get("ะฐะบัะธะฒะฐัะธั")
                                        .and_then(|v| v.as_f64())
                                        .unwrap_or(0.5) as f32,
                                    ะดะพะผะธะฝะฐะฝัะฝะพััั: ัะผะพัะธั.get("ะดะพะผะธะฝะฐะฝัะฝะพััั")
                                        .and_then(|v| v.as_f64())
                                        .unwrap_or(0.4) as f32,
                                    ะดััะตะฒะฝะพััั: ัะผะพัะธั.get("ะดััะตะฒะฝะพััั")
                                        .and_then(|v| v.as_f64())
                                        .unwrap_or(0.8) as f32,
                                    ะพัะบัะพะฒะตะฝะฝะพััั: ัะผะพัะธั.get("ะพัะบัะพะฒะตะฝะฝะพััั")
                                        .and_then(|v| v.as_f64())
                                        .unwrap_or(0.7) as f32,
                                };
                                ัะผะพัะธะธ.push(ัะพััะพัะฝะธะต);
                            }
                        }
                    }
                }
            }
        }
        
        // ะัะปะธ ะฝะตั ะดะฐะฝะฝัั, ะธัะฟะพะปัะทะพะฒะฐัั ะฟัะธะผะตัั ะฟะพ ัะผะพะปัะฐะฝะธั
        if ัะปะพะฒะฐัั.is_empty() {
            let ัะปะพะฒะฐ_ะฟะพ_ัะผะพะปัะฐะฝะธั = vec![
                "ะ", "ั", "ะธ", "ะฒ", "ะต", "ั", "ะ", "ะด", "ะฐ", "ั", "ั", "ะน",
                "ะ", "ะพ", " ", "ะฝ", "ั", "ะก", "ะฟ", "ะฑ", "ะถ", "ะป", "ะบ", "ะผ",
                "ะฏ", "ั", "ั", "ะณ", "ั", "ั", "ั", "ั", "ั", "ั", "ั", "ั",
                "ะ", "ะข", "ะฃ", "ะ", "ะ", "ะ", "ะ", "ะ", "ะ", "ะ", "ะ", "ะ",
                "ะ", "ะ", "ะ", "ะ", "ะค", "ะฅ", "ะฆ", "ะง", "ะจ", "ะฉ", "ะช", "ะซ",
                "ะฌ", "ะญ", "ะฎ", "!", "?", ",", ".", "-", ":", ";", "0", "1",
                "2", "3", "4", "5", "6", "7", "8", "9"
            ];
            ัะปะพะฒะฐัั = ัะปะพะฒะฐ_ะฟะพ_ัะผะพะปัะฐะฝะธั.iter().map(|s| s.to_string()).collect();
        }
        
        Ok(Self {
            ัะปะพะฒะฐัั,
            ะฟัะตะดะปะพะถะตะฝะธั,
            ัะผะพัะธะธ,
        })
    }
    
    fn ัะพะบะตะฝะธะทะธัะพะฒะฐัั(&self, ัะตะบัั: &str) -> Vec<usize> {
        ัะตะบัั.chars()
            .filter_map(|ัะธะผะฒะพะป| {
                let ัััะพะบะฐ = ัะธะผะฒะพะป.to_string();
                self.ัะปะพะฒะฐัั.iter()
                    .position(|v| v == &ัััะพะบะฐ)
            })
            .collect()
    }
    
    fn ะดะตัะพะบะตะฝะธะทะธัะพะฒะฐัั(&self, ัะพะบะตะฝั: &[usize]) -> String {
        ัะพะบะตะฝั.iter()
            .filter_map(|&ะธะฝะดะตะบั| self.ัะปะพะฒะฐัั.get(ะธะฝะดะตะบั))
            .cloned()
            .collect::<Vec<_>>()
            .join("")
    }
}

/// ะะปะฐะฒะฝะฐั ะดะตะผะพะฝัััะฐัะธะพะฝะฝะฐั ััะฝะบัะธั
fn ะทะฐะฟัััะธัั_ะดะตะผะพ() -> Result<()> {
    println!("{}", "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ".cyan());
    println!("{}", "โ     ๐ท๐บ TINKYBINK ะะฃะกะกะะะ GPT - ะะะขะะะะะะขะฃะะะฌะะะฏ AAC     โ".cyan().bold());
    println!("{}", "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ".cyan());
    println!();
    
    // ะะฐะณััะทะธัั ััะตะฝะธัะพะฒะพัะฝัะต ะดะฐะฝะฝัะต
    println!("{} ะะฐะณััะทะบะฐ ััััะบะธั ััะตะฝะธัะพะฒะพัะฝัั ะดะฐะฝะฝัั...", "โ".green());
    let ะทะฐะณััะทัะธะบ = ะัััะบะธะนะะฐะณััะทัะธะบะะฐะฝะฝัั::ะฝะพะฒัะน()?;
    println!("{} ะกะปะพะฒะฐัั: {} ัะธะผะฒะพะปะพะฒ", "โ".green(), ะทะฐะณััะทัะธะบ.ัะปะพะฒะฐัั.len());
    println!("{} ะขัะตะฝะธัะพะฒะพัะฝัะต ะฟัะตะดะปะพะถะตะฝะธั: {}", "โ".green(), ะทะฐะณััะทัะธะบ.ะฟัะตะดะปะพะถะตะฝะธั.len());
    println!("{} ะญะผะพัะธะพะฝะฐะปัะฝัะต ัะพััะพัะฝะธั: {}", "โ".green(), ะทะฐะณััะทัะธะบ.ัะผะพัะธะธ.len());
    println!();
    
    // ะะฐัััะพะธัั ะผะพะดะตะปั
    let ะบะพะฝัะธะณ = ะะพะฝัะธะณััะฐัะธัGPT {
        ัะฐะทะผะตั_ัะปะพะฒะฐัั: ะทะฐะณััะทัะธะบ.ัะปะพะฒะฐัั.len().max(1000),
        ัะบัััะฐั_ัะฐะทะผะตัะฝะพััั: 256,
        ะบะพะปะธัะตััะฒะพ_ัะปะพะตะฒ: 6,
        ะบะพะปะธัะตััะฒะพ_ะณะพะปะพะฒ: 8,
        ะดะปะธะฝะฐ_ะบะพะฝัะตะบััะฐ: 512,
        ะบะพัััะธัะธะตะฝั_ะพััะตะฒะฐ: 0.1,
        ัะผะพัะธะพะฝะฐะปัะฝะฐั_ัะตะผะฟะตัะฐัััะฐ: 0.65,
    };
    
    println!("{} ะะฝะธัะธะฐะปะธะทะฐัะธั ััััะบะพะณะพ GPT ัะดัะฐ...", "โ".yellow());
    let mut ะผะพะดะตะปั = ะัััะบะพะตะฏะดัะพGPT::ะฝะพะฒะพะต(ะบะพะฝัะธะณ);
    println!("{} ะะพะดะตะปั ะณะพัะพะฒะฐ!", "โ".green().bold());
    println!();
    
    // ะะตะฝั ะดะตะผะพะฝัััะฐัะธะธ
    loop {
        println!("{}", "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ".magenta());
        println!("{}", "โ      ะะะะฎ ะะะะะะกะขะะะฆะะ              โ".magenta().bold());
        println!("{}", "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค".magenta());
        println!("{}", "โ 1. ะะตะฝะตัะฐัะธั ััััะบะพะณะพ ะฟัะธะฒะตัััะฒะธั   โ".magenta());
        println!("{}", "โ 2. ะััะฐะถะตะฝะธะต ะฑะฐะทะพะฒะพะน ะฟะพััะตะฑะฝะพััะธ    โ".magenta());
        println!("{}", "โ 3. ะะพะบะฐะทะฐัั ะบัะปััััะฝัั ัะผะพัะธั       โ".magenta());
        println!("{}", "โ 4. ะะฝัะตัะฐะบัะธะฒะฝัะน ะดะธะฐะปะพะณ             โ".magenta());
        println!("{}", "โ 5. ะะตะผะพะฝัััะฐัะธั ััััะบะพะน ะดััะธ        โ".magenta());
        println!("{}", "โ 6. ะญะบัััะตะฝะฝะฐั ัะธััะฐัะธั              โ".magenta());
        println!("{}", "โ 0. ะััะพะด                            โ".magenta());
        println!("{}", "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ".magenta());
        
        print!("\n{} ะัะฑะตัะธัะต ะพะฟัะธั: ", "โ".cyan());
        io::stdout().flush()?;
        
        let mut ะฒะฒะพะด = String::new();
        io::stdin().read_line(&mut ะฒะฒะพะด)?;
        
        match ะฒะฒะพะด.trim() {
            "1" => ะดะตะผะพะฝัััะธัะพะฒะฐัั_ะฟัะธะฒะตัััะฒะธะต(&mut ะผะพะดะตะปั, &ะทะฐะณััะทัะธะบ)?,
            "2" => ะดะตะผะพะฝัััะธัะพะฒะฐัั_ะฟะพััะตะฑะฝะพััั(&mut ะผะพะดะตะปั, &ะทะฐะณััะทัะธะบ)?,
            "3" => ะดะตะผะพะฝัััะธัะพะฒะฐัั_ัะผะพัะธั(&mut ะผะพะดะตะปั, &ะทะฐะณััะทัะธะบ)?,
            "4" => ะธะฝัะตัะฐะบัะธะฒะฝัะน_ะดะธะฐะปะพะณ(&mut ะผะพะดะตะปั, &ะทะฐะณััะทัะธะบ)?,
            "5" => ะดะตะผะพะฝัััะธัะพะฒะฐัั_ะดััั(&mut ะผะพะดะตะปั, &ะทะฐะณััะทัะธะบ)?,
            "6" => ะดะตะผะพะฝัััะธัะพะฒะฐัั_ัะบัััะตะฝะฝัั(&mut ะผะพะดะตะปั, &ะทะฐะณััะทัะธะบ)?,
            "0" => {
                println!("\n{} ะะพ ัะฒะธะดะฐะฝะธั! ะัะตะณะพ ะดะพะฑัะพะณะพ!", "๐".to_string().yellow());
                break;
            }
            _ => println!("{} ะะตะฒะตัะฝะฐั ะพะฟัะธั", "โ".red()),
        }
        
        println!();
    }
    
    Ok(())
}

fn ะดะตะผะพะฝัััะธัะพะฒะฐัั_ะฟัะธะฒะตัััะฒะธะต(ะผะพะดะตะปั: &mut ะัััะบะพะตะฏะดัะพGPT, ะทะฐะณััะทัะธะบ: &ะัััะบะธะนะะฐะณััะทัะธะบะะฐะฝะฝัั) -> Result<()> {
    println!("\n{}", "=== ะะะะะะะฆะะฏ ะะฃะกะกะะะะ ะะะะะะขะกะขะะะฏ ===".green().bold());
    
    // ะฃััะฐะฝะพะฒะธัั ะดััะถะตะปัะฑะฝะพะต ะดััะตะฒะฝะพะต ัะผะพัะธะพะฝะฐะปัะฝะพะต ัะพััะพัะฝะธะต
    ะผะพะดะตะปั.ะพะฑะฝะพะฒะธัั_ัะผะพัะธั(ะญะผะพัะธะพะฝะฐะปัะฝะพะตะกะพััะพัะฝะธะต {
        ะฒะฐะปะตะฝัะฝะพััั: 0.9,
        ะฐะบัะธะฒะฐัะธั: 0.6,
        ะดะพะผะธะฝะฐะฝัะฝะพััั: 0.5,
        ะดััะตะฒะฝะพััั: 0.9,
        ะพัะบัะพะฒะตะฝะฝะพััั: 0.8,
    });
    
    let ะฟะพะดัะบะฐะทะบะธ = vec![
        "ะัะธะฒะตั",
        "ะะดัะฐะฒััะฒัะน",
        "ะะพะฑััะน",
    ];
    
    for ะฟะพะดัะบะฐะทะบะฐ in ะฟะพะดัะบะฐะทะบะธ {
        let ัะพะบะตะฝั = ะทะฐะณััะทัะธะบ.ัะพะบะตะฝะธะทะธัะพะฒะฐัั(ะฟะพะดัะบะฐะทะบะฐ);
        if !ัะพะบะตะฝั.is_empty() {
            let ัะณะตะฝะตัะธัะพะฒะฐะฝะพ = ะผะพะดะตะปั.ะณะตะฝะตัะธัะพะฒะฐัั(&ัะพะบะตะฝั, 5)?;
            let ัะตะบัั = ะทะฐะณััะทัะธะบ.ะดะตัะพะบะตะฝะธะทะธัะพะฒะฐัั(&ัะณะตะฝะตัะธัะพะฒะฐะฝะพ);
            println!("{} {} โ {}", "๐ฌ".to_string(), ะฟะพะดัะบะฐะทะบะฐ.yellow(), ัะตะบัั.green());
        }
    }
    
    Ok(())
}

fn ะดะตะผะพะฝัััะธัะพะฒะฐัั_ะฟะพััะตะฑะฝะพััั(ะผะพะดะตะปั: &mut ะัััะบะพะตะฏะดัะพGPT, ะทะฐะณััะทัะธะบ: &ะัััะบะธะนะะฐะณััะทัะธะบะะฐะฝะฝัั) -> Result<()> {
    println!("\n{}", "=== ะะซะะะะะะะ ะะะขะะะะะะกะขะะ ===".blue().bold());
    
    // ะญะผะพัะธะพะฝะฐะปัะฝะพะต ัะพััะพัะฝะธะต ะฟะพััะตะฑะฝะพััะธ
    ะผะพะดะตะปั.ะพะฑะฝะพะฒะธัั_ัะผะพัะธั(ะญะผะพัะธะพะฝะฐะปัะฝะพะตะกะพััะพัะฝะธะต {
        ะฒะฐะปะตะฝัะฝะพััั: 0.3,
        ะฐะบัะธะฒะฐัะธั: 0.7,
        ะดะพะผะธะฝะฐะฝัะฝะพััั: 0.4,
        ะดััะตะฒะฝะพััั: 0.6,
        ะพัะบัะพะฒะตะฝะฝะพััั: 0.8,
    });
    
    let ะฟะพััะตะฑะฝะพััะธ = vec![
        "ะฏ ัะพัั",
        "ะะฝะต ะฝัะถะฝะพ",
        "ะฏ ะณะพะปะพะดะตะฝ",
    ];
    
    for ะฟะพััะตะฑะฝะพััั in ะฟะพััะตะฑะฝะพััะธ {
        let ัะพะบะตะฝั = ะทะฐะณััะทัะธะบ.ัะพะบะตะฝะธะทะธัะพะฒะฐัั(ะฟะพััะตะฑะฝะพััั);
        if !ัะพะบะตะฝั.is_empty() {
            let ัะณะตะฝะตัะธัะพะฒะฐะฝะพ = ะผะพะดะตะปั.ะณะตะฝะตัะธัะพะฒะฐัั(&ัะพะบะตะฝั, 4)?;
            let ัะตะบัั = ะทะฐะณััะทัะธะบ.ะดะตัะพะบะตะฝะธะทะธัะพะฒะฐัั(&ัะณะตะฝะตัะธัะพะฒะฐะฝะพ);
            println!("{} {} โ {}", "๐".to_string(), ะฟะพััะตะฑะฝะพััั.yellow(), ัะตะบัั.cyan());
        }
    }
    
    Ok(())
}

fn ะดะตะผะพะฝัััะธัะพะฒะฐัั_ัะผะพัะธั(ะผะพะดะตะปั: &mut ะัััะบะพะตะฏะดัะพGPT, ะทะฐะณััะทัะธะบ: &ะัััะบะธะนะะฐะณััะทัะธะบะะฐะฝะฝัั) -> Result<()> {
    println!("\n{}", "=== ะะฃะะฌะขะฃะะะซะ ะญะะะฆะะะะะะฌะะซะ ะะซะะะะะะะฏ ===".magenta().bold());
    
    let ัะผะพัะธะธ = vec![
        ("ะกัะฐัััะต", ะญะผะพัะธะพะฝะฐะปัะฝะพะตะกะพััะพัะฝะธะต {
            ะฒะฐะปะตะฝัะฝะพััั: 1.0,
            ะฐะบัะธะฒะฐัะธั: 0.8,
            ะดะพะผะธะฝะฐะฝัะฝะพััั: 0.6,
            ะดััะตะฒะฝะพััั: 0.9,
            ะพัะบัะพะฒะตะฝะฝะพััั: 0.9,
        }, "๐"),
        ("ะััััั", ะญะผะพัะธะพะฝะฐะปัะฝะพะตะกะพััะพัะฝะธะต {
            ะฒะฐะปะตะฝัะฝะพััั: 0.1,
            ะฐะบัะธะฒะฐัะธั: 0.3,
            ะดะพะผะธะฝะฐะฝัะฝะพััั: 0.2,
            ะดััะตะฒะฝะพััั: 0.8,
            ะพัะบัะพะฒะตะฝะฝะพััั: 0.7,
        }, "๐ข"),
        ("ะััะตะฒะฝะพััั", ะญะผะพัะธะพะฝะฐะปัะฝะพะตะกะพััะพัะฝะธะต {
            ะฒะฐะปะตะฝัะฝะพััั: 0.7,
            ะฐะบัะธะฒะฐัะธั: 0.5,
            ะดะพะผะธะฝะฐะฝัะฝะพััั: 0.5,
            ะดััะตะฒะฝะพััั: 1.0,
            ะพัะบัะพะฒะตะฝะฝะพััั: 1.0,
        }, "๐"),
    ];
    
    for (ะฝะฐะทะฒะฐะฝะธะต, ัะผะพัะธั, ัะผะพะดะทะธ) in ัะผะพัะธะธ {
        ะผะพะดะตะปั.ะพะฑะฝะพะฒะธัั_ัะผะพัะธั(ัะผะพัะธั);
        let ัะพะบะตะฝั = ะทะฐะณััะทัะธะบ.ัะพะบะตะฝะธะทะธัะพะฒะฐัั("ะฏ");
        if !ัะพะบะตะฝั.is_empty() {
            let ัะณะตะฝะตัะธัะพะฒะฐะฝะพ = ะผะพะดะตะปั.ะณะตะฝะตัะธัะพะฒะฐัั(&ัะพะบะตะฝั, 6)?;
            let ัะตะบัั = ะทะฐะณััะทัะธะบ.ะดะตัะพะบะตะฝะธะทะธัะพะฒะฐัั(&ัะณะตะฝะตัะธัะพะฒะฐะฝะพ);
            println!("{} {} โ {}", ัะผะพะดะทะธ, ะฝะฐะทะฒะฐะฝะธะต.yellow(), ัะตะบัั.magenta());
        }
    }
    
    Ok(())
}

fn ะธะฝัะตัะฐะบัะธะฒะฝัะน_ะดะธะฐะปะพะณ(ะผะพะดะตะปั: &mut ะัััะบะพะตะฏะดัะพGPT, ะทะฐะณััะทัะธะบ: &ะัััะบะธะนะะฐะณััะทัะธะบะะฐะฝะฝัั) -> Result<()> {
    println!("\n{}", "=== ะะะขะะะะะขะะะะซะ ะะะะะะ ===".cyan().bold());
    println!("{}", "ะะธัะธัะต ะฝะฐ ััััะบะพะผ (ะธะปะธ 'ะฒััะพะด' ะดะปั ะทะฐะฒะตััะตะฝะธั)".italic());
    
    loop {
        print!("\n{} ะั: ", "๐ค".to_string());
        io::stdout().flush()?;
        
        let mut ะฒะฒะพะด = String::new();
        io::stdin().read_line(&mut ะฒะฒะพะด)?;
        let ะฒะฒะพะด = ะฒะฒะพะด.trim();
        
        if ะฒะฒะพะด == "ะฒััะพะด" {
            break;
        }
        
        // ะะฝะฐะปะธะทะธัะพะฒะฐัั ัะผะพัะธั ะฒะฒะพะดะฐ
        let ัะผะพัะธั = ะฐะฝะฐะปะธะทะธัะพะฒะฐัั_ัะผะพัะธั_ะฒะฒะพะดะฐ(ะฒะฒะพะด);
        ะผะพะดะตะปั.ะพะฑะฝะพะฒะธัั_ัะผะพัะธั(ัะผะพัะธั);
        
        let ัะพะบะตะฝั = ะทะฐะณััะทัะธะบ.ัะพะบะตะฝะธะทะธัะพะฒะฐัั(ะฒะฒะพะด);
        if !ัะพะบะตะฝั.is_empty() {
            let ัะณะตะฝะตัะธัะพะฒะฐะฝะพ = ะผะพะดะตะปั.ะณะตะฝะตัะธัะพะฒะฐัั(&ัะพะบะตะฝั, 8)?;
            let ะพัะฒะตั = ะทะฐะณััะทัะธะบ.ะดะตัะพะบะตะฝะธะทะธัะพะฒะฐัั(&ัะณะตะฝะตัะธัะพะฒะฐะฝะพ);
            println!("{} TinkyBink: {}", "๐ค".to_string(), ะพัะฒะตั.green());
        } else {
            println!("{} TinkyBink: {}", "๐ค".to_string(), "ะัะพััะธัะต, ะฝะต ะฟะพะฝัะป. ะะพะฒัะพัะธัะต, ะฟะพะถะฐะปัะนััะฐ".yellow());
        }
    }
    
    Ok(())
}

fn ะดะตะผะพะฝัััะธัะพะฒะฐัั_ะดััั(ะผะพะดะตะปั: &mut ะัััะบะพะตะฏะดัะพGPT, ะทะฐะณััะทัะธะบ: &ะัััะบะธะนะะฐะณััะทัะธะบะะฐะฝะฝัั) -> Result<()> {
    println!("\n{}", "=== ะะะะะะกะขะะะฆะะฏ ะะฃะกะกะะะ ะะฃะจะ ===".red().bold());
    
    // ะะฐะบัะธะผะฐะปัะฝะฐั ะดััะตะฒะฝะพััั ะธ ะพัะบัะพะฒะตะฝะฝะพััั
    ะผะพะดะตะปั.ะพะฑะฝะพะฒะธัั_ัะผะพัะธั(ะญะผะพัะธะพะฝะฐะปัะฝะพะตะกะพััะพัะฝะธะต {
        ะฒะฐะปะตะฝัะฝะพััั: 0.8,
        ะฐะบัะธะฒะฐัะธั: 0.7,
        ะดะพะผะธะฝะฐะฝัะฝะพััั: 0.5,
        ะดััะตะฒะฝะพััั: 1.0,
        ะพัะบัะพะฒะตะฝะฝะพััั: 1.0,
    });
    
    let ะฒััะฐะถะตะฝะธั = vec![
        "ะััะฐ ะผะพั",
        "ะฃัะฐ",
        "ะกะฟะฐัะธะฑะพ",
    ];
    
    for ะฒััะฐะถ in ะฒััะฐะถะตะฝะธั {
        let ัะพะบะตะฝั = ะทะฐะณััะทัะธะบ.ัะพะบะตะฝะธะทะธัะพะฒะฐัั(ะฒััะฐะถ);
        if !ัะพะบะตะฝั.is_empty() {
            let ัะณะตะฝะตัะธัะพะฒะฐะฝะพ = ะผะพะดะตะปั.ะณะตะฝะตัะธัะพะฒะฐัั(&ัะพะบะตะฝั, 6)?;
            let ัะตะบัั = ะทะฐะณััะทัะธะบ.ะดะตัะพะบะตะฝะธะทะธัะพะฒะฐัั(&ัะณะตะฝะตัะธัะพะฒะฐะฝะพ);
            println!("{} {} โ {}", "๐ฅ".to_string(), ะฒััะฐะถ.red(), ัะตะบัั.yellow().bold());
        }
    }
    
    Ok(())
}

fn ะดะตะผะพะฝัััะธัะพะฒะฐัั_ัะบัััะตะฝะฝัั(ะผะพะดะตะปั: &mut ะัััะบะพะตะฏะดัะพGPT, ะทะฐะณััะทัะธะบ: &ะัััะบะธะนะะฐะณััะทัะธะบะะฐะฝะฝัั) -> Result<()> {
    println!("\n{}", "=== ะญะะกะขะะะะะะฏ ะกะะขะฃะะฆะะฏ ===".red().bold().on_yellow());
    
    // ะกะพััะพัะฝะธะต ััะพัะฝะพััะธ
    ะผะพะดะตะปั.ะพะฑะฝะพะฒะธัั_ัะผะพัะธั(ะญะผะพัะธะพะฝะฐะปัะฝะพะตะกะพััะพัะฝะธะต {
        ะฒะฐะปะตะฝัะฝะพััั: 0.1,
        ะฐะบัะธะฒะฐัะธั: 1.0,
        ะดะพะผะธะฝะฐะฝัะฝะพััั: 0.3,
        ะดััะตะฒะฝะพััั: 0.5,
        ะพัะบัะพะฒะตะฝะฝะพััั: 1.0,
    });
    
    let ัะบัััะตะฝะฝัะต = vec![
        "ะะพะผะพะณะธัะต",
        "ะะฝะต ะฑะพะปัะฝะพ",
        "ะัะทะพะฒะธัะต ะฒัะฐัะฐ",
    ];
    
    for ัะบัััะตะฝะฝะพะต in ัะบัััะตะฝะฝัะต {
        let ัะพะบะตะฝั = ะทะฐะณััะทัะธะบ.ัะพะบะตะฝะธะทะธัะพะฒะฐัั(ัะบัััะตะฝะฝะพะต);
        if !ัะพะบะตะฝั.is_empty() {
            let ัะณะตะฝะตัะธัะพะฒะฐะฝะพ = ะผะพะดะตะปั.ะณะตะฝะตัะธัะพะฒะฐัั(&ัะพะบะตะฝั, 5)?;
            let ัะตะบัั = ะทะฐะณััะทัะธะบ.ะดะตัะพะบะตะฝะธะทะธัะพะฒะฐัั(&ัะณะตะฝะตัะธัะพะฒะฐะฝะพ);
            println!("{} {} โ {}", "๐จ".to_string(), ัะบัััะตะฝะฝะพะต.red().bold(), ัะตะบัั.on_red().white());
        }
    }
    
    println!("\n{} ะะฒะพะฝะธะผ 112...", "๐".to_string().blink());
    
    Ok(())
}

fn ะฐะฝะฐะปะธะทะธัะพะฒะฐัั_ัะผะพัะธั_ะฒะฒะพะดะฐ(ัะตะบัั: &str) -> ะญะผะพัะธะพะฝะฐะปัะฝะพะตะกะพััะพัะฝะธะต {
    let ัะตะบัั_ะฝะธะถะฝะธะน = ัะตะบัั.to_lowercase();
    
    // ะะฐะทะพะฒัะน ะฐะฝะฐะปะธะท ะฝะฐัััะพะตะฝะธั
    let ะฟะพะทะธัะธะฒะฝัะต_ัะปะพะฒะฐ = ["ััะฐััะปะธะฒ", "ัะฐะด", "ัะพัะพัะพ", "ะพัะปะธัะฝะพ", "ะฟัะตะบัะฐัะฝะพ", "ะปัะฑะปั"];
    let ะฝะตะณะฐัะธะฒะฝัะต_ัะปะพะฒะฐ = ["ะณััััะฝะพ", "ะฟะปะพัะพ", "ะฑะพะปัะฝะพ", "ัััะฐัะฝะพ", "ะทะปะพะน", "ัััะฐะป"];
    let ััะพัะฝัะต_ัะปะพะฒะฐ = ["ะฟะพะผะพะณะธัะต", "ััะพัะฝะพ", "ะฑะพะปัะฝะพ", "ะฝัะถะฝะพ", "ัะบัััะตะฝะฝะพ"];
    let ะดััะตะฒะฝัะต_ัะปะพะฒะฐ = ["ะดััะฐ", "ัะตัะดัะต", "ะปัะฑะพะฒั", "ัะพะดะฝะพะน", "ะผะธะปัะน"];
    
    let mut ะฒะฐะปะตะฝัะฝะพััั: f32 = 0.5;
    let mut ะฐะบัะธะฒะฐัะธั: f32 = 0.5;
    let mut ะดััะตะฒะฝะพััั: f32 = 0.8;
    let mut ะพัะบัะพะฒะตะฝะฝะพััั: f32 = 0.7;
    
    for ัะปะพะฒะพ in ะฟะพะทะธัะธะฒะฝัะต_ัะปะพะฒะฐ.iter() {
        if ัะตะบัั_ะฝะธะถะฝะธะน.contains(ัะปะพะฒะพ) {
            ะฒะฐะปะตะฝัะฝะพััั += 0.2;
            ะฐะบัะธะฒะฐัะธั += 0.1;
        }
    }
    
    for ัะปะพะฒะพ in ะฝะตะณะฐัะธะฒะฝัะต_ัะปะพะฒะฐ.iter() {
        if ัะตะบัั_ะฝะธะถะฝะธะน.contains(ัะปะพะฒะพ) {
            ะฒะฐะปะตะฝัะฝะพััั -= 0.2;
            ะฐะบัะธะฒะฐัะธั += 0.1;
        }
    }
    
    for ัะปะพะฒะพ in ััะพัะฝัะต_ัะปะพะฒะฐ.iter() {
        if ัะตะบัั_ะฝะธะถะฝะธะน.contains(ัะปะพะฒะพ) {
            ะฐะบัะธะฒะฐัะธั = 1.0;
            ะพัะบัะพะฒะตะฝะฝะพััั = 1.0;
        }
    }
    
    for ัะปะพะฒะพ in ะดััะตะฒะฝัะต_ัะปะพะฒะฐ.iter() {
        if ัะตะบัั_ะฝะธะถะฝะธะน.contains(ัะปะพะฒะพ) {
            ะดััะตะฒะฝะพััั = 1.0;
            ะพัะบัะพะฒะตะฝะฝะพััั = 0.9;
        }
    }
    
    // ะะพัะบะปะธัะฐัะตะปัะฝัะต ะทะฝะฐะบะธ ัะฒะตะปะธัะธะฒะฐัั ะฐะบัะธะฒะฐัะธั
    let ะฒะพัะบะปะธัะฐะฝะธั = ัะตะบัั.matches('!').count() as f32;
    ะฐะบัะธะฒะฐัะธั = (ะฐะบัะธะฒะฐัะธั + ะฒะพัะบะปะธัะฐะฝะธั * 0.1).min(1.0);
    ะพัะบัะพะฒะตะฝะฝะพััั = (ะพัะบัะพะฒะตะฝะฝะพััั + ะฒะพัะบะปะธัะฐะฝะธั * 0.05).min(1.0);
    
    ะญะผะพัะธะพะฝะฐะปัะฝะพะตะกะพััะพัะฝะธะต {
        ะฒะฐะปะตะฝัะฝะพััั: ะฒะฐะปะตะฝัะฝะพััั.clamp(0.0, 1.0),
        ะฐะบัะธะฒะฐัะธั: ะฐะบัะธะฒะฐัะธั.clamp(0.0, 1.0),
        ะดะพะผะธะฝะฐะฝัะฝะพััั: 0.5,
        ะดััะตะฒะฝะพััั: ะดััะตะฒะฝะพััั.clamp(0.0, 1.0),
        ะพัะบัะพะฒะตะฝะฝะพััั: ะพัะบัะพะฒะตะฝะฝะพััั.clamp(0.0, 1.0),
    }
}

fn main() {
    println!("{}", "
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                    โ
โ   โโโโโโโโโโโโโโโโ   โโโโโโ  โโโโโโ   โโโโโโโโโโ โโโโโโโ   โโโโโโ  โโโ  โ
โ   โโโโโโโโโโโโโโโโโ  โโโโโโ โโโโโโโโ โโโโโโโโโโโโโโโโโโโโ  โโโโโโ โโโโ  โ
โ      โโโ   โโโโโโโโโ โโโโโโโโโโ  โโโโโโโ โโโโโโโโโโโโโโโโโ โโโโโโโโโโ   โ
โ      โโโ   โโโโโโโโโโโโโโโโโโโโ   โโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ      โโโ   โโโโโโ โโโโโโโโโ  โโโ   โโโ   โโโโโโโโโโโโโโ โโโโโโโโโ  โโโ  โ
โ      โโโ   โโโโโโ  โโโโโโโโ  โโโ   โโโ   โโโโโโโ โโโโโโ  โโโโโโโโ  โโโ  โ
โ                                                                    โ
โ                  ๐ท๐บ ะะฃะกะกะะะ GPT - ะะฃะจะะะะะฏ ะกะะกะขะะะ ๐ท๐บ               โ
โ                                                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    ".bright_red().bold());
    
    if let Err(e) = ะทะฐะฟัััะธัั_ะดะตะผะพ() {
        eprintln!("{} ะัะธะฑะบะฐ: {}", "โ".red().bold(), e);
        std::process::exit(1);
    }
}