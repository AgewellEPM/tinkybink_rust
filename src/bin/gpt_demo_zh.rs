//! ğŸ‡¨ğŸ‡³ ä¸­æ–‡GPTæ¼”ç¤º - æ™ºèƒ½AACç³»ç»Ÿ
//!
//! å±•ç¤ºä¸­æ–‡GPTæ ¸å¿ƒçš„å¼ºå¤§åŠŸèƒ½ï¼š
//! - è‡ªç„¶ä¸­æ–‡è¯­è¨€å¤„ç†
//! - æ–‡åŒ–æƒ…æ„Ÿæ„ŸçŸ¥
//! - ä¸­æ–‡ä¼šè¯æ¨¡å¼
//! - è®­ç»ƒæ•°æ®é›†æˆ

use anyhow::Result;
use colored::*;
use serde_json::Value;
use std::fs;
use std::io::{self, Write};
use std::path::Path;
use tinkybink_rust::ai::gpt_core_zh::{GPTé…ç½®, ä¸­æ–‡GPTæ ¸å¿ƒ, æƒ…æ„ŸçŠ¶æ€};

/// ä¸­æ–‡è®­ç»ƒæ•°æ®åŠ è½½å™¨
struct ä¸­æ–‡æ•°æ®åŠ è½½å™¨ {
    è¯æ±‡è¡¨: Vec<String>,
    å¥å­é›†: Vec<Vec<String>>,
    æƒ…æ„Ÿé›†: Vec<æƒ…æ„ŸçŠ¶æ€>,
}

impl ä¸­æ–‡æ•°æ®åŠ è½½å™¨ {
    fn æ–°å»º() -> Result<Self> {
        let mut è¯æ±‡è¡¨ = Vec::new();
        let mut å¥å­é›† = Vec::new();
        let mut æƒ…æ„Ÿé›† = Vec::new();

        // åŠ è½½æ‰€æœ‰ä¸­æ–‡è®­ç»ƒæ–‡ä»¶
        let è®­ç»ƒç›®å½• = Path::new("training_zh");
        if è®­ç»ƒç›®å½•.exists() {
            for æ¡ç›® in fs::read_dir(è®­ç»ƒç›®å½•)? {
                let æ¡ç›® = æ¡ç›®?;
                let è·¯å¾„ = æ¡ç›®.path();
                if è·¯å¾„.extension().and_then(|s| s.to_str()) == Some("json") {
                    let å†…å®¹ = fs::read_to_string(&è·¯å¾„)?;
                    let æ•°æ®: Value = serde_json::from_str(&å†…å®¹)?;

                    if let Some(èŠ‚ç‚¹) = æ•°æ®["nodes"].as_array() {
                        for èŠ‚ç‚¹é¡¹ in èŠ‚ç‚¹ {
                            // æå–æ–‡æœ¬
                            if let Some(æ–‡æœ¬) = èŠ‚ç‚¹é¡¹["text"].as_str() {
                                let å­—ç¬¦: Vec<String> = æ–‡æœ¬.chars().map(|c| c.to_string()).collect();
                                å¥å­é›†.push(å­—ç¬¦.clone());
                                for å­— in å­—ç¬¦ {
                                    if !è¯æ±‡è¡¨.contains(&å­—) {
                                        è¯æ±‡è¡¨.push(å­—);
                                    }
                                }
                            }

                            // æå–æƒ…æ„Ÿ
                            if let Some(æƒ…æ„Ÿ) = èŠ‚ç‚¹é¡¹["emotion"].as_object() {
                                let çŠ¶æ€ = æƒ…æ„ŸçŠ¶æ€ {
                                    ä»·å€¼æ€§: æƒ…æ„Ÿ.get("ä»·å€¼æ€§").and_then(|v| v.as_f64()).unwrap_or(0.5) as f32,
                                    æ¿€æ´»åº¦: æƒ…æ„Ÿ.get("æ¿€æ´»åº¦").and_then(|v| v.as_f64()).unwrap_or(0.5) as f32,
                                    ä¸»å¯¼æ€§: æƒ…æ„Ÿ.get("ä¸»å¯¼æ€§").and_then(|v| v.as_f64()).unwrap_or(0.3) as f32,
                                    å«è“„åº¦: æƒ…æ„Ÿ.get("å«è“„åº¦").and_then(|v| v.as_f64()).unwrap_or(0.7) as f32,
                                    å’Œè°æ€§: æƒ…æ„Ÿ.get("å’Œè°æ€§").and_then(|v| v.as_f64()).unwrap_or(0.8) as f32,
                                };
                                æƒ…æ„Ÿé›†.push(çŠ¶æ€);
                            }
                        }
                    }
                }
            }
        }

        // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤ç¤ºä¾‹
        if è¯æ±‡è¡¨.is_empty() {
            let é»˜è®¤è¯æ±‡ = vec![
                "ä½ ", "å¥½", "æ—©", "ä¸Š", "æ™š", "å†", "è§", "è°¢", "è°¢", "æˆ‘", "å¾ˆ", "å¼€", "å¿ƒ", "éš¾", "è¿‡", "é¥¿", "äº†",
                "æ¸´", "æƒ³", "ç¡", "è§‰", "å¦ˆ", "çˆ¸", "è€", "å¸ˆ", "åŒ", "å­¦", "åƒ", "é¥­", "å–", "æ°´", "ç©", "æ¸¸", "æˆ",
                "å›", "å®¶", "å­¦", "æ ¡", "ä½œ", "ä¸š", "ä¼‘", "æ¯", "åŠ ", "æ²¹", "å¯¹", "ä¸", "èµ·", "æ²¡", "å…³", "ç³»", "è¯·",
                "å¸®", "åŠ©", "ç–¼", "æ•‘", "å‘½", "åŒ»", "ç”Ÿ", "çˆ±", "å–œ", "æ¬¢", "å®³", "æ€•",
            ];
            è¯æ±‡è¡¨ = é»˜è®¤è¯æ±‡.iter().map(|s| s.to_string()).collect();
        }

        Ok(Self { è¯æ±‡è¡¨, å¥å­é›†, æƒ…æ„Ÿé›† })
    }

    fn åˆ†è¯(&self, æ–‡æœ¬: &str) -> Vec<usize> {
        æ–‡æœ¬
            .chars()
            .filter_map(|å­—ç¬¦| {
                let å­—ç¬¦ä¸² = å­—ç¬¦.to_string();
                self.è¯æ±‡è¡¨.iter().position(|v| v == &å­—ç¬¦ä¸²)
            })
            .collect()
    }

    fn ç»„è¯(&self, ä»¤ç‰Œ: &[usize]) -> String {
        ä»¤ç‰Œ.iter().filter_map(|&ç´¢å¼•| self.è¯æ±‡è¡¨.get(ç´¢å¼•)).cloned().collect::<Vec<_>>().join("")
    }
}

/// ä¸»æ¼”ç¤ºå‡½æ•°
fn è¿è¡Œæ¼”ç¤º() -> Result<()> {
    println!("{}", "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—".cyan());
    println!("{}", "â•‘      ğŸ‡¨ğŸ‡³ TINKYBINK ä¸­æ–‡GPT - æ™ºèƒ½AACç³»ç»Ÿ      â•‘".cyan().bold());
    println!("{}", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•".cyan());
    println!();

    // åŠ è½½è®­ç»ƒæ•°æ®
    println!("{} åŠ è½½ä¸­æ–‡è®­ç»ƒæ•°æ®...", "â†’".green());
    let åŠ è½½å™¨ = ä¸­æ–‡æ•°æ®åŠ è½½å™¨::æ–°å»º()?;
    println!("{} è¯æ±‡é‡ï¼š{} ä¸ªå­—ç¬¦", "âœ“".green(), åŠ è½½å™¨.è¯æ±‡è¡¨.len());
    println!("{} è®­ç»ƒå¥å­ï¼š{} å¥", "âœ“".green(), åŠ è½½å™¨.å¥å­é›†.len());
    println!("{} æƒ…æ„ŸçŠ¶æ€ï¼š{} ä¸ª", "âœ“".green(), åŠ è½½å™¨.æƒ…æ„Ÿé›†.len());
    println!();

    // é…ç½®æ¨¡å‹
    let é…ç½® = GPTé…ç½® {
        è¯æ±‡é‡å¤§å°: åŠ è½½å™¨.è¯æ±‡è¡¨.len().max(1000),
        éšè—å±‚ç»´åº¦: 256,
        å±‚æ•°: 6,
        æ³¨æ„åŠ›å¤´æ•°: 8,
        ä¸Šä¸‹æ–‡é•¿åº¦: 512,
        dropoutç‡: 0.1,
        æƒ…æ„Ÿæ¸©åº¦: 0.6,
    };

    println!("{} åˆå§‹åŒ–ä¸­æ–‡GPTæ ¸å¿ƒ...", "â†’".yellow());
    let mut æ¨¡å‹ = ä¸­æ–‡GPTæ ¸å¿ƒ::æ–°å»º(é…ç½®);
    println!("{} æ¨¡å‹å‡†å¤‡å°±ç»ªï¼", "âœ“".green().bold());
    println!();

    // æ¼”ç¤ºèœå•
    loop {
        println!("{}", "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”".magenta());
        println!("{}", "â”‚           æ¼”ç¤ºèœå•                   â”‚".magenta().bold());
        println!("{}", "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤".magenta());
        println!("{}", "â”‚ 1. ç”Ÿæˆä¸­æ–‡é—®å€™                      â”‚".magenta());
        println!("{}", "â”‚ 2. è¡¨è¾¾åŸºæœ¬éœ€æ±‚                      â”‚".magenta());
        println!("{}", "â”‚ 3. å±•ç¤ºæ–‡åŒ–æƒ…æ„Ÿ                      â”‚".magenta());
        println!("{}", "â”‚ 4. äº’åŠ¨å¯¹è¯                          â”‚".magenta());
        println!("{}", "â”‚ 5. å’Œè°è¡¨è¾¾æ¼”ç¤º                      â”‚".magenta());
        println!("{}", "â”‚ 6. ç´§æ€¥æƒ…å†µ                          â”‚".magenta());
        println!("{}", "â”‚ 0. é€€å‡º                              â”‚".magenta());
        println!("{}", "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜".magenta());

        print!("\n{} è¯·é€‰æ‹©é€‰é¡¹ï¼š", "â†’".cyan());
        io::stdout().flush()?;

        let mut è¾“å…¥ = String::new();
        io::stdin().read_line(&mut è¾“å…¥)?;

        match è¾“å…¥.trim() {
            "1" => æ¼”ç¤ºé—®å€™(&mut æ¨¡å‹, &åŠ è½½å™¨)?,
            "2" => æ¼”ç¤ºéœ€æ±‚(&mut æ¨¡å‹, &åŠ è½½å™¨)?,
            "3" => æ¼”ç¤ºæƒ…æ„Ÿ(&mut æ¨¡å‹, &åŠ è½½å™¨)?,
            "4" => äº’åŠ¨å¯¹è¯(&mut æ¨¡å‹, &åŠ è½½å™¨)?,
            "5" => æ¼”ç¤ºå’Œè°(&mut æ¨¡å‹, &åŠ è½½å™¨)?,
            "6" => æ¼”ç¤ºç´§æ€¥(&mut æ¨¡å‹, &åŠ è½½å™¨)?,
            "0" => {
                println!("\n{} å†è§ï¼ç¥æ‚¨ä¸€åˆ‡é¡ºåˆ©ï¼", "ğŸ‘‹".to_string().yellow());
                break;
            }
            _ => println!("{} æ— æ•ˆé€‰é¡¹", "âœ—".red()),
        }

        println!();
    }

    Ok(())
}

fn æ¼”ç¤ºé—®å€™(æ¨¡å‹: &mut ä¸­æ–‡GPTæ ¸å¿ƒ, åŠ è½½å™¨: &ä¸­æ–‡æ•°æ®åŠ è½½å™¨) -> Result<()> {
    println!("\n{}", "=== ä¸­æ–‡é—®å€™ç”Ÿæˆ ===".green().bold());

    // è®¾ç½®å‹å¥½å’Œè°çš„æƒ…æ„ŸçŠ¶æ€
    æ¨¡å‹.æ›´æ–°æƒ…æ„Ÿ(æƒ…æ„ŸçŠ¶æ€ { ä»·å€¼æ€§: 0.9, æ¿€æ´»åº¦: 0.6, ä¸»å¯¼æ€§: 0.4, å«è“„åº¦: 0.6, å’Œè°æ€§: 0.9 });

    let æç¤ºè¯ = vec!["ä½ å¥½", "æ—©ä¸Š", "æ™šä¸Š"];

    for æç¤º in æç¤ºè¯ {
        let ä»¤ç‰Œ = åŠ è½½å™¨.åˆ†è¯(æç¤º);
        if !ä»¤ç‰Œ.is_empty() {
            let ç”Ÿæˆ = æ¨¡å‹.ç”Ÿæˆ(&ä»¤ç‰Œ, 5)?;
            let æ–‡æœ¬ = åŠ è½½å™¨.ç»„è¯(&ç”Ÿæˆ);
            println!("{} {} â†’ {}", "ğŸ’¬".to_string(), æç¤º.yellow(), æ–‡æœ¬.green());
        }
    }

    Ok(())
}

fn æ¼”ç¤ºéœ€æ±‚(æ¨¡å‹: &mut ä¸­æ–‡GPTæ ¸å¿ƒ, åŠ è½½å™¨: &ä¸­æ–‡æ•°æ®åŠ è½½å™¨) -> Result<()> {
    println!("\n{}", "=== åŸºæœ¬éœ€æ±‚è¡¨è¾¾ ===".blue().bold());

    // éœ€æ±‚çŠ¶æ€çš„æƒ…æ„Ÿ
    æ¨¡å‹.æ›´æ–°æƒ…æ„Ÿ(æƒ…æ„ŸçŠ¶æ€ { ä»·å€¼æ€§: 0.4, æ¿€æ´»åº¦: 0.7, ä¸»å¯¼æ€§: 0.5, å«è“„åº¦: 0.5, å’Œè°æ€§: 0.7 });

    let éœ€æ±‚è¯ = vec!["æˆ‘é¥¿", "æˆ‘æ¸´", "æˆ‘æƒ³"];

    for éœ€æ±‚ in éœ€æ±‚è¯ {
        let ä»¤ç‰Œ = åŠ è½½å™¨.åˆ†è¯(éœ€æ±‚);
        if !ä»¤ç‰Œ.is_empty() {
            let ç”Ÿæˆ = æ¨¡å‹.ç”Ÿæˆ(&ä»¤ç‰Œ, 4)?;
            let æ–‡æœ¬ = åŠ è½½å™¨.ç»„è¯(&ç”Ÿæˆ);
            println!("{} {} â†’ {}", "ğŸ†˜".to_string(), éœ€æ±‚.yellow(), æ–‡æœ¬.cyan());
        }
    }

    Ok(())
}

fn æ¼”ç¤ºæƒ…æ„Ÿ(æ¨¡å‹: &mut ä¸­æ–‡GPTæ ¸å¿ƒ, åŠ è½½å™¨: &ä¸­æ–‡æ•°æ®åŠ è½½å™¨) -> Result<()> {
    println!("\n{}", "=== æ–‡åŒ–æƒ…æ„Ÿè¡¨è¾¾ ===".magenta().bold());

    let æƒ…æ„Ÿåˆ—è¡¨ = vec![
        ("å¼€å¿ƒ", æƒ…æ„ŸçŠ¶æ€ { ä»·å€¼æ€§: 0.9, æ¿€æ´»åº¦: 0.7, ä¸»å¯¼æ€§: 0.5, å«è“„åº¦: 0.6, å’Œè°æ€§: 0.9 }, "ğŸ˜Š"),
        ("éš¾è¿‡", æƒ…æ„ŸçŠ¶æ€ { ä»·å€¼æ€§: 0.2, æ¿€æ´»åº¦: 0.3, ä¸»å¯¼æ€§: 0.2, å«è“„åº¦: 0.8, å’Œè°æ€§: 0.6 }, "ğŸ˜¢"),
        ("å’Œè°", æƒ…æ„ŸçŠ¶æ€ { ä»·å€¼æ€§: 0.8, æ¿€æ´»åº¦: 0.5, ä¸»å¯¼æ€§: 0.5, å«è“„åº¦: 0.7, å’Œè°æ€§: 1.0 }, "â˜®ï¸"),
    ];

    for (åç§°, æƒ…æ„Ÿ, è¡¨æƒ…) in æƒ…æ„Ÿåˆ—è¡¨ {
        æ¨¡å‹.æ›´æ–°æƒ…æ„Ÿ(æƒ…æ„Ÿ);
        let ä»¤ç‰Œ = åŠ è½½å™¨.åˆ†è¯("æˆ‘");
        if !ä»¤ç‰Œ.is_empty() {
            let ç”Ÿæˆ = æ¨¡å‹.ç”Ÿæˆ(&ä»¤ç‰Œ, 6)?;
            let æ–‡æœ¬ = åŠ è½½å™¨.ç»„è¯(&ç”Ÿæˆ);
            println!("{} {} â†’ {}", è¡¨æƒ…, åç§°.yellow(), æ–‡æœ¬.magenta());
        }
    }

    Ok(())
}

fn äº’åŠ¨å¯¹è¯(æ¨¡å‹: &mut ä¸­æ–‡GPTæ ¸å¿ƒ, åŠ è½½å™¨: &ä¸­æ–‡æ•°æ®åŠ è½½å™¨) -> Result<()> {
    println!("\n{}", "=== äº’åŠ¨å¯¹è¯ ===".cyan().bold());
    println!("{}", "è¯·è¾“å…¥ä¸­æ–‡ï¼ˆè¾“å…¥'é€€å‡º'ç»“æŸï¼‰".italic());

    loop {
        print!("\n{} æ‚¨ï¼š", "ğŸ‘¤".to_string());
        io::stdout().flush()?;

        let mut è¾“å…¥ = String::new();
        io::stdin().read_line(&mut è¾“å…¥)?;
        let è¾“å…¥ = è¾“å…¥.trim();

        if è¾“å…¥ == "é€€å‡º" {
            break;
        }

        // åˆ†æè¾“å…¥æƒ…æ„Ÿ
        let æƒ…æ„Ÿ = åˆ†æè¾“å…¥æƒ…æ„Ÿ(è¾“å…¥);
        æ¨¡å‹.æ›´æ–°æƒ…æ„Ÿ(æƒ…æ„Ÿ);

        let ä»¤ç‰Œ = åŠ è½½å™¨.åˆ†è¯(è¾“å…¥);
        if !ä»¤ç‰Œ.is_empty() {
            let ç”Ÿæˆ = æ¨¡å‹.ç”Ÿæˆ(&ä»¤ç‰Œ, 8)?;
            let å›å¤ = åŠ è½½å™¨.ç»„è¯(&ç”Ÿæˆ);
            println!("{} TinkyBinkï¼š{}", "ğŸ¤–".to_string(), å›å¤.green());
        } else {
            println!("{} TinkyBinkï¼š{}", "ğŸ¤–".to_string(), "ä¸å¥½æ„æ€ï¼Œè¯·å†è¯´ä¸€é".yellow());
        }
    }

    Ok(())
}

fn æ¼”ç¤ºå’Œè°(æ¨¡å‹: &mut ä¸­æ–‡GPTæ ¸å¿ƒ, åŠ è½½å™¨: &ä¸­æ–‡æ•°æ®åŠ è½½å™¨) -> Result<()> {
    println!("\n{}", "=== å’Œè°è¡¨è¾¾æ¼”ç¤º ===".green().bold());

    // æœ€å¤§å’Œè°ä¸å«è“„
    æ¨¡å‹.æ›´æ–°æƒ…æ„Ÿ(æƒ…æ„ŸçŠ¶æ€ { ä»·å€¼æ€§: 0.8, æ¿€æ´»åº¦: 0.5, ä¸»å¯¼æ€§: 0.3, å«è“„åº¦: 0.9, å’Œè°æ€§: 1.0 });

    let è¡¨è¾¾ = vec!["è°¢è°¢", "å¯¹ä¸èµ·", "æ²¡å…³ç³»"];

    for è¯è¯­ in è¡¨è¾¾ {
        let ä»¤ç‰Œ = åŠ è½½å™¨.åˆ†è¯(è¯è¯­);
        if !ä»¤ç‰Œ.is_empty() {
            let ç”Ÿæˆ = æ¨¡å‹.ç”Ÿæˆ(&ä»¤ç‰Œ, 6)?;
            let æ–‡æœ¬ = åŠ è½½å™¨.ç»„è¯(&ç”Ÿæˆ);
            println!("{} {} â†’ {}", "ğŸ•Šï¸".to_string(), è¯è¯­.green(), æ–‡æœ¬.yellow());
        }
    }

    Ok(())
}

fn æ¼”ç¤ºç´§æ€¥(æ¨¡å‹: &mut ä¸­æ–‡GPTæ ¸å¿ƒ, åŠ è½½å™¨: &ä¸­æ–‡æ•°æ®åŠ è½½å™¨) -> Result<()> {
    println!("\n{}", "=== ç´§æ€¥æƒ…å†µ ===".red().bold().on_yellow());

    // ç´§æ€¥çŠ¶æ€
    æ¨¡å‹.æ›´æ–°æƒ…æ„Ÿ(æƒ…æ„ŸçŠ¶æ€ {
        ä»·å€¼æ€§: 0.1,
        æ¿€æ´»åº¦: 1.0,
        ä¸»å¯¼æ€§: 0.3,
        å«è“„åº¦: 0.2, // ç´§æ€¥æ—¶ä¸å«è“„
        å’Œè°æ€§: 0.5,
    });

    let ç´§æ€¥è¯ = vec!["æ•‘å‘½", "æˆ‘ç–¼", "å«åŒ»ç”Ÿ"];

    for ç´§æ€¥ in ç´§æ€¥è¯ {
        let ä»¤ç‰Œ = åŠ è½½å™¨.åˆ†è¯(ç´§æ€¥);
        if !ä»¤ç‰Œ.is_empty() {
            let ç”Ÿæˆ = æ¨¡å‹.ç”Ÿæˆ(&ä»¤ç‰Œ, 5)?;
            let æ–‡æœ¬ = åŠ è½½å™¨.ç»„è¯(&ç”Ÿæˆ);
            println!("{} {} â†’ {}", "ğŸš¨".to_string(), ç´§æ€¥.red().bold(), æ–‡æœ¬.on_red().white());
        }
    }

    println!("\n{} æ‹¨æ‰“120æ€¥æ•‘ç”µè¯...", "ğŸ“".to_string().blink());

    Ok(())
}

fn åˆ†æè¾“å…¥æƒ…æ„Ÿ(æ–‡æœ¬: &str) -> æƒ…æ„ŸçŠ¶æ€ {
    // åŸºç¡€æƒ…æ„Ÿåˆ†æ
    let æ­£é¢è¯ = ["å¼€å¿ƒ", "å¥½", "å–œæ¬¢", "çˆ±", "å¿«ä¹", "é«˜å…´", "æ£’"];
    let è´Ÿé¢è¯ = ["éš¾è¿‡", "ä¸å¥½", "ç–¼", "å®³æ€•", "ç”Ÿæ°”", "ç´¯"];
    let ç´§æ€¥è¯ = ["æ•‘å‘½", "ç´§æ€¥", "ç–¼", "éœ€è¦", "å¸®åŠ©"];
    let å’Œè°è¯ = ["è°¢è°¢", "è¯·", "å¯¹ä¸èµ·", "æ²¡å…³ç³»", "è¾›è‹¦"];

    let mut ä»·å€¼æ€§: f32 = 0.5;
    let mut æ¿€æ´»åº¦: f32 = 0.5;
    let mut å«è“„åº¦: f32 = 0.7;
    let mut å’Œè°æ€§: f32 = 0.8;

    for è¯ in æ­£é¢è¯.iter() {
        if æ–‡æœ¬.contains(è¯) {
            ä»·å€¼æ€§ += 0.2;
            æ¿€æ´»åº¦ += 0.1;
        }
    }

    for è¯ in è´Ÿé¢è¯.iter() {
        if æ–‡æœ¬.contains(è¯) {
            ä»·å€¼æ€§ -= 0.2;
            æ¿€æ´»åº¦ += 0.1;
        }
    }

    for è¯ in ç´§æ€¥è¯.iter() {
        if æ–‡æœ¬.contains(è¯) {
            æ¿€æ´»åº¦ = 1.0;
            å«è“„åº¦ = 0.2;
        }
    }

    for è¯ in å’Œè°è¯.iter() {
        if æ–‡æœ¬.contains(è¯) {
            å’Œè°æ€§ = 1.0;
            å«è“„åº¦ = 0.8;
        }
    }

    // æ„Ÿå¹å·å‡å°‘å«è“„åº¦
    let æ„Ÿå¹å·æ•° = æ–‡æœ¬.matches('ï¼').count() as f32;
    å«è“„åº¦ = (å«è“„åº¦ - æ„Ÿå¹å·æ•° * 0.1).max(0.0);

    æƒ…æ„ŸçŠ¶æ€ {
        ä»·å€¼æ€§: ä»·å€¼æ€§.clamp(0.0, 1.0),
        æ¿€æ´»åº¦: æ¿€æ´»åº¦.clamp(0.0, 1.0),
        ä¸»å¯¼æ€§: 0.5,
        å«è“„åº¦: å«è“„åº¦.clamp(0.0, 1.0),
        å’Œè°æ€§: å’Œè°æ€§.clamp(0.0, 1.0),
    }
}

fn main() {
    println!(
        "{}",
        "
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                    â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—  â•‘
â•‘   â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•  â•‘
â•‘      â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•   â•‘
â•‘      â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•—   â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•—   â•‘
â•‘      â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—  â•‘
â•‘      â•šâ•â•   â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•  â•šâ•â•   â•šâ•â•   â•šâ•â•â•â•â•â• â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•  â•šâ•â•  â•‘
â•‘                                                                    â•‘
â•‘                  ğŸ‡¨ğŸ‡³ ä¸­æ–‡GPT - æ™ºèƒ½äº¤æµç³»ç»Ÿ ğŸ‡¨ğŸ‡³                     â•‘
â•‘                                                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    "
        .bright_red()
        .bold()
    );

    if let Err(e) = è¿è¡Œæ¼”ç¤º() {
        eprintln!("{} é”™è¯¯ï¼š{}", "âœ—".red().bold(), e);
        std::process::exit(1);
    }
}
