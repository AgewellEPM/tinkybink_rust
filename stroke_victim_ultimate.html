<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TinkyBink AAC - Ultimate Nobel Prize System</title>
    <style>
        :root {
            --primary: #7b3ff2;
            --secondary: #2563eb;
            --success: #059669;
            --danger: #dc2626;
            --warning: #d97706;
            --dark: #1f2937;
            --light: #f8fafc;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 20px;
        }
        
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .caregiver-panel {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .patient-panel {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.8rem;
        }
        
        .subtitle {
            color: #6b7280;
            margin-bottom: 24px;
            font-size: 0.9rem;
        }
        
        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .question-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .question-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .ask-btn {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .ask-btn:hover {
            background: #6d28d9;
            transform: translateY(-1px);
        }
        
        .core-tiles {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            padding: 16px;
            background: #f0f9ff;
            border-radius: 8px;
        }
        
        .tiles-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .tile {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #bfdbfe;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .tile:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: var(--primary);
        }
        
        .tile.selected {
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
            border-color: var(--primary);
            transform: scale(1.05);
        }
        
        .tile.core {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border-color: #fbbf24;
        }
        
        .tile-emoji {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }
        
        .tile-word {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .tile-confidence {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--success);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .spoken-output {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .spoken-label {
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .spoken-text {
            font-size: 1.1rem;
            color: var(--dark);
            line-height: 1.5;
        }
        
        .conversation-history {
            max-height: 200px;
            overflow-y: auto;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            margin-top: 16px;
        }
        
        .conversation-turn {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .conversation-turn:last-child {
            border-bottom: none;
        }
        
        .visual-story {
            display: flex;
            gap: 8px;
            padding: 12px;
            background: linear-gradient(90deg, #fef3c7 0%, #fed7aa 100%);
            border-radius: 8px;
            margin-top: 16px;
            overflow-x: auto;
            min-height: 60px;
            align-items: center;
        }
        
        .story-emoji {
            font-size: 2rem;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .soul-tracker {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .soul-title {
            font-weight: 600;
            color: #be185d;
            margin-bottom: 12px;
        }
        
        .personality-traits {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .trait {
            background: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            border: 1px solid #fbcfe8;
        }
        
        .home-button {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 1000;
        }
        
        .home-button:hover {
            background: #b91c1c;
            transform: translateY(-2px);
        }
        
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .core-tiles {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <button class="home-button" onclick="resetToHome()">üè† Home</button>
    
    <div class="container">
        <div class="left-panel">
            <!-- Caregiver Panel -->
            <div class="caregiver-panel">
                <h1>üë©‚Äç‚öïÔ∏è Caregiver Interface</h1>
                <p class="subtitle">Ask ANY question - AI generates tiles</p>
                
                <div class="input-group">
                    <input type="text" 
                           class="question-input" 
                           id="questionInput" 
                           placeholder="Ask any question..."
                           onkeypress="if(event.key === 'Enter') askQuestion()">
                    <button class="ask-btn" onclick="askQuestion()">Ask</button>
                </div>
                
                <div class="spoken-output" id="spokenOutput" style="display: none;">
                    <div class="spoken-label">
                        üîä Patient Says:
                    </div>
                    <div class="spoken-text" id="spokenText"></div>
                </div>
                
                <div class="conversation-history" id="conversationHistory">
                    <p style="color: #9ca3af; text-align: center;">No conversation yet...</p>
                </div>
            </div>
            
            <!-- Soul Tracker -->
            <div class="soul-tracker">
                <div class="soul-title">üíú Digital Soul Profile</div>
                <div class="personality-traits" id="personalityTraits">
                    <span class="trait">Initializing...</span>
                </div>
            </div>
        </div>
        
        <!-- Patient Panel -->
        <div class="patient-panel">
            <h1>üß† Patient View - TinkyBink AAC</h1>
            <p class="subtitle">Simple tiles that speak full sentences</p>
            
            <!-- Core Vocabulary - Always Visible -->
            <div class="core-tiles" id="coreTiles">
                <div class="tile core" onclick="selectCoreTile('Want')">
                    <div class="tile-emoji">üí≠</div>
                    <div class="tile-word">I Want</div>
                </div>
                <div class="tile core" onclick="selectCoreTile('Places')">
                    <div class="tile-emoji">üìç</div>
                    <div class="tile-word">Places</div>
                </div>
                <div class="tile core" onclick="selectCoreTile('Help')">
                    <div class="tile-emoji">üÜò</div>
                    <div class="tile-word">Help</div>
                </div>
                <div class="tile core" onclick="selectCoreTile('Food')">
                    <div class="tile-emoji">üçΩÔ∏è</div>
                    <div class="tile-word">Food</div>
                </div>
                <div class="tile core" onclick="selectCoreTile('People')">
                    <div class="tile-emoji">üë•</div>
                    <div class="tile-word">People</div>
                </div>
                <div class="tile core" onclick="selectCoreTile('Action')">
                    <div class="tile-emoji">üèÉ</div>
                    <div class="tile-word">Action</div>
                </div>
                <div class="tile core" onclick="selectCoreTile('Feel')">
                    <div class="tile-emoji">üòä</div>
                    <div class="tile-word">Feel</div>
                </div>
                <div class="tile core" onclick="selectCoreTile('Home')">
                    <div class="tile-emoji">üè†</div>
                    <div class="tile-word">Home</div>
                </div>
            </div>
            
            <!-- Dynamic Tiles Container -->
            <div class="tiles-container" id="dynamicTiles">
                <!-- AI-generated tiles appear here -->
            </div>
            
            <!-- Visual Story -->
            <div class="visual-story" id="visualStory">
                <span style="color: #9ca3af;">Your story will appear here...</span>
            </div>
        </div>
    </div>
    
    <script>
        // TinkyBink Ultimate AAC System
        class TinkyBinkAAC {
            constructor() {
                this.currentContext = null;
                this.conversationHistory = [];
                this.visualStory = [];
                this.personalityTraits = new Set();
                this.expansionTree = [];
                this.currentExpansionLevel = 0;
                
                // Comprehensive vocabulary mappings
                this.conceptMappings = {
                    // Food concepts
                    hungry: ['üçî', 'üçï', 'üåÆ', 'üçú', 'ü•ó', 'üçó'],
                    thirsty: ['üíß', 'ü•§', '‚òï', 'üçµ', 'ü•õ', 'üßÉ'],
                    breakfast: ['ü•û', 'ü•ö', 'ü•ì', 'ü•£', 'üç≥', 'üßá'],
                    lunch: ['ü•™', 'üçî', 'üçï', 'ü•ó', 'üç≤', 'üåØ'],
                    dinner: ['üçù', 'üçñ', 'üçó', 'ü•ò', 'üçõ', 'üçú'],
                    
                    // Emotions
                    happy: ['üòä', 'üòÑ', 'ü•∞', 'üòÅ', 'ü§ó', 'üòÉ'],
                    sad: ['üò¢', 'üòî', 'üòû', 'üòü', 'üò≠', 'ü•∫'],
                    pain: ['üò£', 'ü§ï', 'üòñ', 'üò´', 'üíä', 'ü©π'],
                    tired: ['üò¥', 'ü•±', 'üò™', 'üí§', 'üõèÔ∏è', 'üò©'],
                    anxious: ['üò∞', 'üòü', 'üò®', 'üòß', 'ü´®', 'üò•'],
                    
                    // Activities
                    tv: ['üì∫', 'üé¨', 'üìΩÔ∏è', 'üé≠', 'üçø', 'üìª'],
                    sports: ['‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'üéæ', 'üèê'],
                    game: ['üéÆ', 'üéØ', 'üé≤', '‚ôüÔ∏è', 'üÉè', 'üé∞'],
                    read: ['üìö', 'üìñ', 'üì∞', 'üìÑ', '‚úçÔ∏è', 'üìù'],
                    music: ['üéµ', 'üé∂', 'üé§', 'üéß', 'üé∏', 'üéπ'],
                    
                    // Places
                    bathroom: ['üöΩ', 'üöø', 'üõÅ', 'ü™•', 'üßª', 'üßº'],
                    bedroom: ['üõèÔ∏è', 'üò¥', 'üõãÔ∏è', 'üí§', 'üïØÔ∏è', 'ü™ü'],
                    outside: ['üå≥', 'üåû', 'üå§Ô∏è', 'üåà', 'üèûÔ∏è', 'üö∂'],
                    store: ['üõí', 'üè™', 'üí≥', 'üõçÔ∏è', 'üí∞', 'üè¨'],
                    
                    // Medical
                    medicine: ['üíä', 'üíâ', 'ü©π', 'ü©∫', 'üå°Ô∏è', 'üè•'],
                    doctor: ['üë®‚Äç‚öïÔ∏è', 'üë©‚Äç‚öïÔ∏è', 'üè•', 'üöë', 'ü©∫', 'üìã'],
                    
                    // People
                    family: ['üë®‚Äçüë©‚Äçüëß‚Äçüë¶', 'üë™', 'üë®', 'üë©', 'üë∂', 'üë¥'],
                    friend: ['üë´', 'üë¨', 'üë≠', 'ü§ù', 'üíë', 'üë•']
                };
                
                // Weizenbaum expansion patterns
                this.expansionPatterns = {
                    yes: {
                        hungry: ['Chinese', 'American', 'Italian', 'Mexican', 'Japanese', 'Indian'],
                        pain: ['Head', 'Chest', 'Back', 'Stomach', 'Legs', 'Arms'],
                        tired: ['Nap now', 'Bed early', 'Rest here', 'Close eyes', 'Lie down', 'Sleep more'],
                        thirsty: ['Water', 'Juice', 'Coffee', 'Tea', 'Milk', 'Soda'],
                        bathroom: ['Right now', 'In minute', 'Need help', 'By myself', 'Emergency', 'Can wait']
                    },
                    
                    // Food expansions
                    chinese: ['Rice', 'Noodles', 'Chicken', 'Beef', 'Vegetables', 'Soup'],
                    american: ['Burger', 'Pizza', 'Hot dog', 'Fries', 'Sandwich', 'Steak'],
                    italian: ['Pasta', 'Pizza', 'Lasagna', 'Risotto', 'Salad', 'Bread'],
                    
                    // Burger expansions
                    burger: ['Cheese', 'Lettuce', 'Tomato', 'Onion', 'Bacon', 'Pickles'],
                    
                    // Activity expansions
                    tv: ['News', 'Sports', 'Movies', 'Shows', 'Netflix', 'YouTube'],
                    sports: ['Football', 'Basketball', 'Baseball', 'Tennis', 'Golf', 'Soccer']
                };
            }
            
            // Process any question and generate tiles
            processQuestion(question) {
                this.currentContext = question;
                const tiles = this.generateDynamicTiles(question);
                this.displayTiles(tiles);
            }
            
            // Generate tiles based on question analysis
            generateDynamicTiles(question) {
                const tiles = [];
                const q = question.toLowerCase();
                
                // Extract concepts from question
                const concepts = this.extractConcepts(q);
                
                // Check for OR questions
                if (q.includes(' or ')) {
                    return this.generateChoiceTiles(q);
                }
                
                // Generate tiles based on concepts found
                for (const concept of concepts) {
                    const conceptTiles = this.generateConceptTiles(concept, q);
                    tiles.push(...conceptTiles);
                }
                
                // Add yes/no if it's a question
                if (q.includes('?')) {
                    tiles.unshift(
                        { emoji: '‚úÖ', text: 'Yes', fullSentence: this.generateYesSentence(q), confidence: 0.95 },
                        { emoji: '‚ùå', text: 'No', fullSentence: this.generateNoSentence(q), confidence: 0.95 }
                    );
                }
                
                // Add contextual tiles based on question type
                if (concepts.length === 0) {
                    tiles.push(...this.generateGeneralTiles(q));
                }
                
                // Limit to 6 tiles and sort by confidence
                return tiles.sort((a, b) => b.confidence - a.confidence).slice(0, 6);
            }
            
            // Extract concepts from question
            extractConcepts(question) {
                const concepts = [];
                
                for (const [concept, emojis] of Object.entries(this.conceptMappings)) {
                    if (question.includes(concept.toLowerCase()) || 
                        (concept === 'hungry' && question.includes('eat')) ||
                        (concept === 'thirsty' && question.includes('drink')) ||
                        (concept === 'tired' && question.includes('sleep')) ||
                        (concept === 'bathroom' && question.includes('toilet'))) {
                        concepts.push(concept);
                    }
                }
                
                return concepts;
            }
            
            // Generate tiles for a concept
            generateConceptTiles(concept, question) {
                const tiles = [];
                const emojis = this.conceptMappings[concept] || ['üí¨'];
                
                // Create diverse response tiles
                if (concept === 'hungry' || concept === 'thirsty') {
                    tiles.push(
                        { emoji: emojis[0], text: 'Very', fullSentence: `Yes, I'm very ${concept}.`, confidence: 0.9 },
                        { emoji: emojis[1], text: 'Little', fullSentence: `Just a little ${concept}.`, confidence: 0.85 },
                        { emoji: emojis[2], text: 'Later', fullSentence: `Maybe later, not ${concept} now.`, confidence: 0.8 }
                    );
                } else if (concept === 'pain') {
                    tiles.push(
                        { emoji: 'üò£', text: 'Hurts', fullSentence: 'Yes, it hurts right here.', confidence: 0.95 },
                        { emoji: 'üíä', text: 'Medicine', fullSentence: 'I need my pain medicine please.', confidence: 0.9 },
                        { emoji: 'üî•', text: 'Burning', fullSentence: 'It\'s a burning sensation.', confidence: 0.85 }
                    );
                } else if (concept === 'tired') {
                    tiles.push(
                        { emoji: 'üò¥', text: 'Sleep', fullSentence: 'I need to sleep now.', confidence: 0.9 },
                        { emoji: 'üõèÔ∏è', text: 'Bed', fullSentence: 'I want to go to bed.', confidence: 0.9 },
                        { emoji: 'üí§', text: 'Rest', fullSentence: 'I just need to rest for a bit.', confidence: 0.85 }
                    );
                }
                
                return tiles;
            }
            
            // Generate choice tiles for OR questions
            generateChoiceTiles(question) {
                const tiles = [];
                const parts = question.split(/\bor\b/i);
                
                parts.forEach(part => {
                    const cleaned = part.replace(/[?.,]/g, '')
                                      .replace(/do you want/i, '')
                                      .replace(/would you like/i, '')
                                      .trim();
                    
                    if (cleaned) {
                        const emoji = this.getEmojiForWord(cleaned);
                        tiles.push({
                            emoji: emoji,
                            text: this.simplifyWord(cleaned),
                            fullSentence: `I would like ${cleaned}, please.`,
                            confidence: 0.95
                        });
                    }
                });
                
                // Add "both" and "neither"
                tiles.push(
                    { emoji: '‚úÖ', text: 'Both', fullSentence: 'I\'d like both options, please.', confidence: 0.85 },
                    { emoji: '‚ùå', text: 'Neither', fullSentence: 'I don\'t want either option right now.', confidence: 0.85 }
                );
                
                return tiles;
            }
            
            // Generate general tiles
            generateGeneralTiles(question) {
                return [
                    { emoji: 'üëç', text: 'Good', fullSentence: 'That sounds good to me.', confidence: 0.85 },
                    { emoji: 'ü§î', text: 'Maybe', fullSentence: 'Maybe, I need to think about it.', confidence: 0.8 },
                    { emoji: '‚ùì', text: 'What?', fullSentence: 'Could you explain that again?', confidence: 0.75 },
                    { emoji: 'üîÑ', text: 'Later', fullSentence: 'Let\'s do that later.', confidence: 0.8 }
                ];
            }
            
            // Generate Weizenbaum-style expansion tiles
            generateExpansionTiles(selectedTile) {
                const selection = selectedTile.text.toLowerCase();
                const originalQuestion = this.currentContext ? this.currentContext.toLowerCase() : '';
                
                // YES/NO expansions based on original question context
                if (selection === 'yes' || selection === 'no') {
                    return this.expandBasedOnOriginalQuestion(selection, originalQuestion);
                }
                
                // Check if we have specific expansion patterns
                const pattern = this.expansionPatterns[selection];
                if (pattern) {
                    return pattern.map(item => ({
                        emoji: this.getEmojiForWord(item),
                        text: this.simplifyWord(item),
                        fullSentence: `I want ${item}.`,
                        confidence: 0.9
                    }));
                }
                
                // Otherwise, expand based on the word itself
                return this.expandBasedOnWord(selection);
            }
            
            // Expand based on original question when Yes/No is selected
            expandBasedOnOriginalQuestion(selection, originalQuestion) {
                const tiles = [];
                
                if (selection === 'yes') {
                    // Check what the question was about
                    if (originalQuestion.includes('hungry') || originalQuestion.includes('eat')) {
                        // Show food categories
                        tiles.push(
                            { emoji: 'ü•°', text: 'Chinese', fullSentence: 'I\'d like Chinese food.', confidence: 0.95 },
                            { emoji: 'üçî', text: 'American', fullSentence: 'I want American food.', confidence: 0.95 },
                            { emoji: 'üçù', text: 'Italian', fullSentence: 'Italian sounds good.', confidence: 0.95 },
                            { emoji: 'üåÆ', text: 'Mexican', fullSentence: 'I\'d like Mexican food.', confidence: 0.95 },
                            { emoji: 'üç±', text: 'Japanese', fullSentence: 'Japanese food please.', confidence: 0.95 },
                            { emoji: 'üçõ', text: 'Indian', fullSentence: 'Indian food sounds nice.', confidence: 0.95 }
                        );
                    } else if (originalQuestion.includes('pain') || originalQuestion.includes('hurt')) {
                        // Show pain locations
                        tiles.push(
                            { emoji: 'ü§ï', text: 'Head', fullSentence: 'My head hurts.', confidence: 0.95 },
                            { emoji: 'üíî', text: 'Chest', fullSentence: 'I have chest pain.', confidence: 0.95 },
                            { emoji: 'üîô', text: 'Back', fullSentence: 'My back hurts.', confidence: 0.95 },
                            { emoji: 'ü§¢', text: 'Stomach', fullSentence: 'My stomach hurts.', confidence: 0.95 },
                            { emoji: 'ü¶µ', text: 'Legs', fullSentence: 'My legs hurt.', confidence: 0.95 },
                            { emoji: 'üí™', text: 'Arms', fullSentence: 'My arms hurt.', confidence: 0.95 }
                        );
                    } else if (originalQuestion.includes('thirsty') || originalQuestion.includes('drink')) {
                        // Show drink options
                        tiles.push(
                            { emoji: 'üíß', text: 'Water', fullSentence: 'I want water please.', confidence: 0.95 },
                            { emoji: 'üßÉ', text: 'Juice', fullSentence: 'I\'d like some juice.', confidence: 0.95 },
                            { emoji: '‚òï', text: 'Coffee', fullSentence: 'Coffee would be nice.', confidence: 0.95 },
                            { emoji: 'üçµ', text: 'Tea', fullSentence: 'I\'d like some tea.', confidence: 0.95 },
                            { emoji: 'ü•õ', text: 'Milk', fullSentence: 'I want milk please.', confidence: 0.95 },
                            { emoji: 'ü•§', text: 'Soda', fullSentence: 'I\'d like a soda.', confidence: 0.95 }
                        );
                    }
                } else if (selection === 'no') {
                    // For "No" responses, offer alternatives
                    tiles.push(
                        { emoji: 'üîÑ', text: 'Later', fullSentence: 'Maybe later, not now.', confidence: 0.9 },
                        { emoji: 'ü§î', text: 'Different', fullSentence: 'I want something different.', confidence: 0.9 },
                        { emoji: 'üò¥', text: 'Tired', fullSentence: 'I\'m too tired right now.', confidence: 0.85 },
                        { emoji: 'üëç', text: 'Fine', fullSentence: 'I\'m fine, thank you.', confidence: 0.85 }
                    );
                }
                
                return tiles;
            }
            
            // Expand based on selected word
            expandBasedOnWord(word) {
                const tiles = [];
                
                // Food expansions
                if (word === 'chinese') {
                    tiles.push(
                        { emoji: 'üçö', text: 'Rice', fullSentence: 'I want fried rice.', confidence: 0.95 },
                        { emoji: 'üçú', text: 'Noodles', fullSentence: 'I\'d like noodles.', confidence: 0.95 },
                        { emoji: 'üçó', text: 'Chicken', fullSentence: 'Sweet and sour chicken please.', confidence: 0.95 },
                        { emoji: 'ü•©', text: 'Beef', fullSentence: 'Beef and broccoli sounds good.', confidence: 0.95 }
                    );
                } else if (word === 'american' || word === 'burger') {
                    tiles.push(
                        { emoji: 'üßÄ', text: 'Cheese', fullSentence: 'Add cheese please.', confidence: 0.95 },
                        { emoji: 'ü•¨', text: 'Lettuce', fullSentence: 'With lettuce please.', confidence: 0.95 },
                        { emoji: 'üçÖ', text: 'Tomato', fullSentence: 'Add tomato please.', confidence: 0.95 },
                        { emoji: 'üßÖ', text: 'Onion', fullSentence: 'With onions please.', confidence: 0.95 },
                        { emoji: 'ü•ì', text: 'Bacon', fullSentence: 'Add bacon please.', confidence: 0.95 }
                    );
                }
                
                return tiles;
            }
            
            // Get emoji for word
            getEmojiForWord(word) {
                const emojiMap = {
                    // Food
                    chinese: 'ü•°', american: 'üçî', italian: 'üçù', mexican: 'üåÆ',
                    japanese: 'üç±', indian: 'üçõ', burger: 'üçî', pizza: 'üçï',
                    rice: 'üçö', noodles: 'üçú', chicken: 'üçó', beef: 'ü•©',
                    cheese: 'üßÄ', lettuce: 'ü•¨', tomato: 'üçÖ', onion: 'üßÖ',
                    bacon: 'ü•ì', pickles: 'ü•í',
                    
                    // Drinks
                    water: 'üíß', juice: 'üßÉ', coffee: '‚òï', tea: 'üçµ',
                    milk: 'ü•õ', soda: 'ü•§',
                    
                    // Body parts
                    head: 'ü§ï', chest: 'üíî', back: 'üîô', stomach: 'ü§¢',
                    legs: 'ü¶µ', arms: 'üí™',
                    
                    // Activities
                    tv: 'üì∫', sports: '‚öΩ', game: 'üéÆ', read: 'üìö',
                    music: 'üéµ', walk: 'üö∂', sleep: 'üò¥',
                    
                    // General
                    yes: '‚úÖ', no: '‚ùå', good: 'üëç', bad: 'üëé',
                    later: 'üîÑ', different: 'üîÄ', tired: 'üò¥', fine: 'üëå'
                };
                
                const lower = word.toLowerCase();
                for (const [key, emoji] of Object.entries(emojiMap)) {
                    if (lower.includes(key)) return emoji;
                }
                
                return 'üí¨';
            }
            
            // Simplify word for display
            simplifyWord(phrase) {
                const words = phrase.split(' ');
                const important = words.filter(w => 
                    !['the', 'a', 'an', 'for', 'to', 'of', 'in', 'on', 'with'].includes(w.toLowerCase())
                );
                
                if (important.length > 0) {
                    const word = important[0];
                    return word.charAt(0).toUpperCase() + word.slice(1);
                }
                
                return phrase.charAt(0).toUpperCase() + phrase.slice(1);
            }
            
            // Generate contextual Yes sentence
            generateYesSentence(question) {
                if (question.includes('hungry')) return 'Yes, I am hungry.';
                if (question.includes('thirsty')) return 'Yes, I am thirsty.';
                if (question.includes('pain')) return 'Yes, I am in pain.';
                if (question.includes('tired')) return 'Yes, I am tired.';
                if (question.includes('bathroom')) return 'Yes, I need the bathroom.';
                if (question.includes('help')) return 'Yes, I need help.';
                return 'Yes, that\'s correct.';
            }
            
            // Generate contextual No sentence
            generateNoSentence(question) {
                if (question.includes('hungry')) return 'No, I\'m not hungry right now.';
                if (question.includes('thirsty')) return 'No, I don\'t need anything to drink.';
                if (question.includes('pain')) return 'No, I\'m not in pain.';
                if (question.includes('tired')) return 'No, I\'m not tired.';
                if (question.includes('bathroom')) return 'No, I don\'t need the bathroom.';
                if (question.includes('help')) return 'No, I don\'t need help right now.';
                return 'No, that\'s not right.';
            }
            
            // Display tiles
            displayTiles(tiles) {
                const container = document.getElementById('dynamicTiles');
                container.innerHTML = '';
                
                tiles.forEach((tile, index) => {
                    const div = document.createElement('div');
                    div.className = 'tile';
                    div.innerHTML = `
                        <span class="tile-confidence">${Math.round(tile.confidence * 100)}%</span>
                        <div class="tile-emoji">${tile.emoji}</div>
                        <div class="tile-word">${tile.text}</div>
                    `;
                    
                    div.onclick = () => this.selectTile(tile, div);
                    
                    // Animate appearance
                    div.style.opacity = '0';
                    div.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        div.style.transition = 'all 0.3s ease';
                        div.style.opacity = '1';
                        div.style.transform = 'translateY(0)';
                    }, index * 50);
                    
                    container.appendChild(div);
                });
            }
            
            // Handle tile selection
            selectTile(tile, element) {
                // Visual feedback
                document.querySelectorAll('.tile').forEach(t => t.classList.remove('selected'));
                if (element) element.classList.add('selected');
                
                // Speak the full sentence
                this.speak(tile.fullSentence);
                
                // Add to visual story
                this.addToVisualStory(tile.emoji);
                
                // Update personality
                this.updatePersonality(tile.text);
                
                // Add to conversation history
                this.addToHistory(this.currentContext, tile);
                
                // Generate expansion tiles (Weizenbaum tree)
                setTimeout(() => {
                    const expansionTiles = this.generateExpansionTiles(tile);
                    if (expansionTiles.length > 0) {
                        this.displayTiles(expansionTiles);
                    }
                }, 500);
            }
            
            // Speak text
            speak(text) {
                const outputDiv = document.getElementById('spokenOutput');
                const textDiv = document.getElementById('spokenText');
                
                outputDiv.style.display = 'block';
                textDiv.textContent = text;
                
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    speechSynthesis.speak(utterance);
                }
            }
            
            // Add to visual story
            addToVisualStory(emoji) {
                this.visualStory.push(emoji);
                if (this.visualStory.length > 12) {
                    this.visualStory.shift();
                }
                
                const storyDiv = document.getElementById('visualStory');
                storyDiv.innerHTML = this.visualStory.map(e => 
                    `<span class="story-emoji">${e}</span>`
                ).join('');
            }
            
            // Update personality profile
            updatePersonality(trait) {
                this.personalityTraits.add(trait);
                const traitsDiv = document.getElementById('personalityTraits');
                const traits = Array.from(this.personalityTraits).slice(-5);
                traitsDiv.innerHTML = traits.map(t => 
                    `<span class="trait">${t}</span>`
                ).join('');
            }
            
            // Add to conversation history
            addToHistory(question, tile) {
                this.conversationHistory.push({ question, tile });
                
                const historyDiv = document.getElementById('conversationHistory');
                const html = `
                    <div class="conversation-turn">
                        <div style="color: #6b7280; font-size: 0.85rem;">Q: ${question || 'Core selection'}</div>
                        <div>${tile.emoji} ${tile.text} ‚Üí "${tile.fullSentence}"</div>
                    </div>
                `;
                
                if (this.conversationHistory.length === 1) {
                    historyDiv.innerHTML = html;
                } else {
                    historyDiv.innerHTML = html + historyDiv.innerHTML;
                }
            }
        }
        
        // Initialize system
        const tinkybink = new TinkyBinkAAC();
        
        // Core tile handlers
        function selectCoreTile(category) {
            const tiles = {
                Want: [
                    { emoji: 'üíß', text: 'Water', fullSentence: 'I want some water please.', confidence: 0.95 },
                    { emoji: 'üçΩÔ∏è', text: 'Food', fullSentence: 'I want something to eat.', confidence: 0.95 },
                    { emoji: 'üöΩ', text: 'Bathroom', fullSentence: 'I want to use the bathroom.', confidence: 0.95 },
                    { emoji: 'üò¥', text: 'Sleep', fullSentence: 'I want to sleep.', confidence: 0.95 },
                    { emoji: 'üì∫', text: 'TV', fullSentence: 'I want to watch TV.', confidence: 0.95 },
                    { emoji: 'üè†', text: 'Home', fullSentence: 'I want to go home.', confidence: 0.95 }
                ],
                Places: [
                    { emoji: 'üõèÔ∏è', text: 'Bedroom', fullSentence: 'I want to go to the bedroom.', confidence: 0.95 },
                    { emoji: 'üöΩ', text: 'Bathroom', fullSentence: 'I need the bathroom.', confidence: 0.95 },
                    { emoji: 'üçΩÔ∏è', text: 'Kitchen', fullSentence: 'Let\'s go to the kitchen.', confidence: 0.95 },
                    { emoji: 'üõãÔ∏è', text: 'Living Room', fullSentence: 'I want to go to the living room.', confidence: 0.95 },
                    { emoji: 'üå≥', text: 'Outside', fullSentence: 'I want to go outside.', confidence: 0.95 },
                    { emoji: 'üè•', text: 'Hospital', fullSentence: 'I need to go to the hospital.', confidence: 0.95 }
                ],
                Help: [
                    { emoji: 'üö∂', text: 'Walk', fullSentence: 'Help me walk please.', confidence: 0.95 },
                    { emoji: 'ü™ë', text: 'Sit', fullSentence: 'Help me sit down.', confidence: 0.95 },
                    { emoji: 'üõèÔ∏è', text: 'Bed', fullSentence: 'Help me get to bed.', confidence: 0.95 },
                    { emoji: 'üëï', text: 'Dress', fullSentence: 'Help me get dressed.', confidence: 0.95 },
                    { emoji: 'üíä', text: 'Medicine', fullSentence: 'I need help with my medicine.', confidence: 0.95 },
                    { emoji: 'üì±', text: 'Phone', fullSentence: 'Help me with the phone.', confidence: 0.95 }
                ],
                Food: [
                    { emoji: 'üç≥', text: 'Breakfast', fullSentence: 'I want breakfast.', confidence: 0.95 },
                    { emoji: 'ü•™', text: 'Lunch', fullSentence: 'I want lunch.', confidence: 0.95 },
                    { emoji: 'üçΩÔ∏è', text: 'Dinner', fullSentence: 'I want dinner.', confidence: 0.95 },
                    { emoji: 'üçé', text: 'Snack', fullSentence: 'I want a snack.', confidence: 0.95 },
                    { emoji: 'üíß', text: 'Drink', fullSentence: 'I want something to drink.', confidence: 0.95 },
                    { emoji: 'üç∞', text: 'Dessert', fullSentence: 'I want dessert.', confidence: 0.95 }
                ],
                People: [
                    { emoji: 'üë®‚Äç‚öïÔ∏è', text: 'Doctor', fullSentence: 'I want to see the doctor.', confidence: 0.95 },
                    { emoji: 'üë©‚Äç‚öïÔ∏è', text: 'Nurse', fullSentence: 'I need the nurse.', confidence: 0.95 },
                    { emoji: 'üë®‚Äçüë©‚Äçüëß', text: 'Family', fullSentence: 'I want to see my family.', confidence: 0.95 },
                    { emoji: 'üë´', text: 'Friend', fullSentence: 'I want to see my friend.', confidence: 0.95 },
                    { emoji: 'üë©', text: 'Wife', fullSentence: 'I want to see my wife.', confidence: 0.95 },
                    { emoji: 'üë®', text: 'Husband', fullSentence: 'I want to see my husband.', confidence: 0.95 }
                ],
                Action: [
                    { emoji: 'üö∂', text: 'Walk', fullSentence: 'I want to walk.', confidence: 0.95 },
                    { emoji: 'üõãÔ∏è', text: 'Sit', fullSentence: 'I want to sit down.', confidence: 0.95 },
                    { emoji: 'üõèÔ∏è', text: 'Lie down', fullSentence: 'I want to lie down.', confidence: 0.95 },
                    { emoji: 'üì∫', text: 'Watch', fullSentence: 'I want to watch something.', confidence: 0.95 },
                    { emoji: 'üìñ', text: 'Read', fullSentence: 'I want to read.', confidence: 0.95 },
                    { emoji: 'üéµ', text: 'Listen', fullSentence: 'I want to listen to music.', confidence: 0.95 }
                ],
                Feel: [
                    { emoji: 'üòä', text: 'Happy', fullSentence: 'I feel happy.', confidence: 0.95 },
                    { emoji: 'üòî', text: 'Sad', fullSentence: 'I feel sad.', confidence: 0.95 },
                    { emoji: 'üò¥', text: 'Tired', fullSentence: 'I feel tired.', confidence: 0.95 },
                    { emoji: 'üò£', text: 'Pain', fullSentence: 'I\'m in pain.', confidence: 0.95 },
                    { emoji: 'üò∞', text: 'Anxious', fullSentence: 'I feel anxious.', confidence: 0.95 },
                    { emoji: 'ü§í', text: 'Sick', fullSentence: 'I feel sick.', confidence: 0.95 }
                ],
                Home: [
                    { emoji: 'üè†', text: 'Go home', fullSentence: 'I want to go home.', confidence: 0.95 },
                    { emoji: 'üì±', text: 'Call home', fullSentence: 'I want to call home.', confidence: 0.95 },
                    { emoji: 'üë®‚Äçüë©‚Äçüëß', text: 'Family', fullSentence: 'I miss my family.', confidence: 0.95 },
                    { emoji: 'üõèÔ∏è', text: 'My bed', fullSentence: 'I want my own bed.', confidence: 0.95 },
                    { emoji: 'üêï', text: 'Pet', fullSentence: 'I miss my pet.', confidence: 0.95 },
                    { emoji: 'üì∏', text: 'Photos', fullSentence: 'I want to see photos from home.', confidence: 0.95 }
                ]
            };
            
            tinkybink.currentContext = `Core: ${category}`;
            tinkybink.displayTiles(tiles[category] || []);
        }
        
        // Process question
        function askQuestion() {
            const input = document.getElementById('questionInput');
            const question = input.value.trim();
            
            if (!question) return;
            
            tinkybink.processQuestion(question);
            input.value = '';
        }
        
        // Reset to home
        function resetToHome() {
            document.getElementById('dynamicTiles').innerHTML = 
                '<p style="color: #9ca3af; text-align: center; grid-column: 1/-1;">Select a core tile or ask a question...</p>';
            document.getElementById('spokenOutput').style.display = 'none';
        }
        
        // Initialize
        window.onload = function() {
            resetToHome();
        };
    </script>
</body>
</html>